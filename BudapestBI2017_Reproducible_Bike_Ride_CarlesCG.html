<!DOCTYPE html>
<html>
  <head>
    <title>A Reproducible Bike Ride in Hamburg</title>
    <meta charset="utf-8">
    <meta name="author" content="Carles CG @ ReliableDynamics" />
    <link href="libs/remark-css/example.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <script src="libs/datatables-binding/datatables.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="libs/css/addstyles.css" type="text/css" />
    <link rel="stylesheet" href="libs/css/fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# A Reproducible Bike Ride in Hamburg
### <em>Carles CG @ ReliableDynamics</em>

---




layout: true

.footer[Slides available at &lt;http://bit.ly/bike_rideR&gt;]
 
---
class: inverse, middle, center   
# Reproducibility + Application in a Case

---
layout: false

.pull-left[
[&lt;img src="libs/www/poster_alex.png"/ width="80%";&gt;](https://www.user2017.brussels/uploads/Kruse_poster-session.pdf)
]

.pull-right[
[&lt;img src="libs/www/alex.png"/ width="40%";&gt;](https://github.com/kruse-alex)
[&lt;img src="libs/www/shiny_app.png"/ width="100%";&gt;](https://alexkruse.shinyapps.io/stadtrad/)
]

---

# Feeling lucky?

.pull-left[
1. Look at Github and found the repo  
[&lt;img src="libs/www/GH_Kruuse.png"/ width="50%";&gt;](https://github.com/kruse-alex/bike_sharing)
&lt;br \&gt; 
2. Found the script file!  
[&lt;img src="libs/www/GH_kruuse_script.png"/ width="100%";&gt;](https://github.com/kruse-alex/bike_sharing)  

3. Download original data &amp; play with it  


]

.pull-right[
<div id="htmlwidget-a99cdc9ccc1796dbfafa" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-a99cdc9ccc1796dbfafa">{"x":{"filter":"none","fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54"],["Hamburg",null,"Frankfurt am Main","Berlin","München","Kassel","Stuttgart","Köln","Darmstadt","Marburg","Rüsselsheim","Wiesbaden","Flugh. Frankfurt","Kiel","Baden-Baden","Halle","Heidelberg","Düsseldorf","Hannover","Mannheim","Troisdorf","Karlsruhe","Freiburg","Göttingen","Bonn","Würzburg","Bremen","Mainz","Aachen","Bamberg","Weimar","Fulda","Magdeburg","Braunschweig","Wolfsburg","Saarbrücken","Bielefeld","Ingolstadt","Erlangen","Kaiserslautern","Aschaffenburg","Gütersloh","Rostock","Warnemünde","Oberhausen","Lübeck","Oldenburg (Oldb)","Hennef","Dortmund","Hanau","Rendsburg","Augsburg","Passau","Norderstedt"],[6431973,1301794,1201123,1000297,765202,544558,458271,448928,251104,179197,58372,28987,6533,1848,1417,1038,866,843,738,696,669,490,487,448,432,428,371,359,299,220,198,195,186,185,184,178,165,154,150,138,135,117,117,115,96,90,61,47,27,23,13,10,3,1]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>City<\/th>\n      <th>Number Of entries<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":8,"columnDefs":[{"className":"dt-right","targets":2},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[8,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

]








---

.pull-twothirdsleft[
[&lt;img src="libs/www/reproducible_peng.png"/ width="50%";&gt;](http://science.sciencemag.org/content/334/6060/1226)   
[&lt;img src="libs/www/Good_enough_practices.png"/ width="75%";&gt; ](http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1005510) 
[&lt;img src="libs/www/best_practices_scientific.png"/ width="75%";&gt;](http://journals.plos.org/plosbiology/article?id=10.1371/journal.pbio.1001745)
]

.pull-onethirdsright[
   .center[
      [&lt;img src="libs/www/book_implementing.jpg"/ width="50%";&gt;](https://www.crcpress.com/Implementing-Reproducible-Research/Stodden-Leisch-Peng/p/book/9781466561595) 
   
   ]
]

---
  
# About me

.pull-left[
&lt;img src="libs/www/logo_Rdynamics.png"/ width="100%";&gt; 
]

.pull-right[
&lt;img src="libs/www/user2017.jpeg"/ width="90%";&gt; 

Carles CG  
Data Scientist &amp; freelanceR   

carles@reliabledynamics.com  
@carles_ 
]


---
class: inverse, middle, center   
# Reproducibility + Application in a Case

---
# Extended... but how? 

A series of extensions were made. 

--
* Archive raw, pre/post process and final data  

--
* Rewrite some parts of the code with `tidyverse` principles

--
* Benchmark reading and munging code

--
* Extend the analysis

--
* Documentation  

--

---
background-image: url("./libs/www/Stuttgart.png")
background-position: cover
background-size: 1400px
class: center, bottom, inverse

&lt;div style="font-family:Lobster;padding:30pt;text-align:center;font-size:40pt;color:#dbd7cd;"&gt;Stuttgart&lt;/div&gt;

---

background-image: url("./libs/www/cities/Kassel.png")
background-position: cover
background-size: 1400px  
class: center, bottom, inverse

&lt;div style="font-family:Lobster;padding:30pt;text-align:center;font-size:40pt;color:#dbd7cd;"&gt;Kassel&lt;/div&gt;

---
background-image: url("./libs/www/cities/Frankfurt am Main.png")
background-position: cover
background-size: 1400px  
class: center, bottom, inverse

&lt;div style="font-family:Lobster;padding:30pt;text-align:center;font-size:40pt;color:#dbd7cd;"&gt;Frankfurt am Main&lt;/div&gt;

---
background-image: url("./libs/www/cities/Berlin.png")
background-position: cover
background-size: 1400px  
class: center, bottom, inverse

&lt;div style="font-family:Lobster;padding:30pt;text-align:center;font-size:40pt;color:#dbd7cd;"&gt;Berlin&lt;/div&gt;

---
background-image: url("./libs/www/cities/Koln.png")
background-position: cover
background-size: 1400px  
class: center, bottom, inverse

&lt;div style="font-family:Lobster;padding:30pt;text-align:center;font-size:40pt;color:#dbd7cd;"&gt;Köln&lt;/div&gt;


---
# Reproducibility... but why? 
  
&lt;br /&gt; &lt;br /&gt; &lt;br /&gt;   
   
&gt; “Reproducibility is the ability to take the code and data from a previous publication, rerun the code and get the same results”

&lt;br /&gt; &lt;br /&gt; 
.textright[
https://simplystatistics.org/2017/03/02/rr-glossy/
]

---
# Reproducibility benefits

--
+ Make it easier for your future self. Data might be expanded in the future!

--
+ Review the basis that lead to decision

--
+ Transparency

--
+ Avoid manual errors 

--
+ Learn new skills

--
+ Science! Reproducibility vs. Replication
  
  
---
# Science

&lt;p align="center"&gt;
&lt;img src="libs/www/peng-spectrum.jpg"/ width="50%";&gt; 
&lt;br /&gt; &lt;br /&gt; 
&lt;/p&gt;


&gt; "**Replication**: This is the act of repeating an entire study, independently of the original investigator without the use of original data (but generally using the same methods).  

&gt; **Reproducibility**: A study is reproducible if you can take the original data and the computer code used to analyze the data and reproduce all of the numerical findings from the study."

&lt;br /&gt; &lt;br /&gt; 
.textright[
https://simplystatistics.org/2016/08/24/replication-crisis/
]

---
# Reproducibility gone wrong
.pull-left[
&lt;Two ways to create hyperlinks in Xaringan &gt;
&lt;a href="https://en.wikipedia.org/wiki/Growth_in_a_Time_of_Debt"&gt;
&lt;img src="libs/www/policy.png"/ width="80%";&gt; 

[&lt;img src="libs/www/tiny_errors.jpg"/ width="80%";&gt;](http://www.russpoldrack.org/2013/02/anatomy-of-coding-error.html) 
]

.pull-right[
[&lt;img src="libs/www/RRwrong_ny.png"/ width="80%";&gt;](
http://www.nytimes.com/2011/07/08/health/research/08genes.html?_r=0)
]


---
class: inverse, middle, center
# (Some) &lt;br /&gt; Principles of reproduciblity

---
# Checklist
Consider...

+ Data

--
+ Code

--
+ Environment

--
+ Documentation

--

*Soft considerations* 

--
+ How important is the output of the analysis?  

--
+ Team effort vs. cowboy coder 

--
+ How much time should we invest to make it till some degrees reproducible?

---

class: inverse, middle, center
# Data Management

---
# Long vs. short term archiving

--
+ Version Control services
[&lt;img src="libs/www/git.png"/ width="25%";&gt;](https://github.com)


--
+ Academia services?

--
+ Private internal repository (avoid silos, AirBnB case)
[&lt;img src="libs/www/AirBnb.png"/ width="20%";&gt;](https://github.com/airbnb/knowledge-repo)
--

+ Data archive services Archive.org, DataHub, Zenovo
[&lt;img src="libs/www/archive.png"/ width="30%";&gt;](https://archive.org)
--
   
---
# Case
.pull-left[
1. Corrupt CSV file after unzipping  
   *Had to upload the raw CSV file, `6Gb` to [archive.org](https://archive.org) to avoid unzipping problems*

2. API   
   *External computations save intermediate results, before &amp; after the API.*

   [&lt;img src="libs/www/cyclestreet.net.png"/ width="75%";&gt;](https://www.cyclestreets.net)

]

.pull-right[
[&lt;img src="libs/www/archive_data_csv.png"/ width="75%";&gt;](https://archive.org/download/HACKATHONBOOKINGCALLABIKE)


]


---
# Case

.pull-left[
API key never hardcoded! Two solutions: 
   1. Control your .Renviron   
   2. Check out the package `secret` by
Gábor Csárdi [aut, cre], Andrie de Vries [aut]
  
   [&lt;img src="libs/www/twitter_secret.png"/ width="75%";&gt;](https://channel9.msdn.com/Events/useR-international-R-User-conferences/useR-International-R-User-2017-Conference/Can-you-keep-a-secret)
   
]

.pull-right[
**.Renviron**  
To set global variables and or set API constants
i.e. ```Sys.getenv('CYCLESTREET')```


```r
# Execute the command at the R console
file.edit('~/.Renviron')
```


```r
# And then add your keys
CYCLESTREET=this_is_my_ip_secret
```

]


---
class: inverse, middle, center

# R Software

---
# Session 
 + The environment is 
&lt;img src="libs/www/Rlogo.png"/ width="5%";&gt;

 + Always include the session information in the documentation. 
 

```r
sessionInfo()
```

```
## R version 3.4.2 (2017-09-28)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS High Sierra 10.13.1
## 
## Matrix products: default
## BLAS: /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.4/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] tools     stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
## [1] dplyr_0.7.4      checkpoint_0.4.1
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.13     rstudioapi_0.7   servr_0.8        bindr_0.1       
##  [5] knitr_1.17       magrittr_1.5     devtools_1.13.2  R6_2.2.2        
##  [9] rlang_0.1.2      stringr_1.2.0    DT_0.2           xaringan_0.4    
## [13] withr_1.0.2      htmltools_0.3.6  yaml_2.1.14      rprojroot_1.2   
## [17] digest_0.6.12    assertthat_0.2.0 tibble_1.3.4     bindrcpp_0.2    
## [21] htmlwidgets_0.9  rsconnect_0.8.5  mime_0.5         glue_1.1.1      
## [25] memoise_1.1.0    evaluate_0.10.1  rmarkdown_1.8    stringi_1.1.6   
## [29] compiler_3.4.2   backports_1.1.0  jsonlite_1.5     httpuv_1.3.5    
## [33] pkgconfig_2.0.1
```

---
# Session

   + Or with package `devtools`

```r
devtools::session_info()
```

```
##  setting  value                       
##  version  R version 3.4.2 (2017-09-28)
##  system   x86_64, darwin15.6.0        
##  ui       RStudio (1.1.345)           
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  tz       &lt;NA&gt;                        
##  date     2017-11-27                  
## 
##  package     * version date       source                            
##  assertthat    0.2.0   2017-04-11 CRAN (R 3.4.0)                    
##  backports     1.1.0   2017-05-22 CRAN (R 3.4.0)                    
##  base        * 3.4.2   2017-10-04 local                             
##  bindr         0.1     2016-11-13 CRAN (R 3.4.0)                    
##  bindrcpp      0.2     2017-06-17 CRAN (R 3.4.0)                    
##  checkpoint  * 0.4.1   2017-06-26 CRAN (R 3.4.1)                    
##  compiler      3.4.2   2017-10-04 local                             
##  datasets    * 3.4.2   2017-10-04 local                             
##  devtools      1.13.2  2017-06-02 CRAN (R 3.4.0)                    
##  digest        0.6.12  2017-01-27 CRAN (R 3.4.0)                    
##  dplyr       * 0.7.4   2017-09-28 CRAN (R 3.4.1)                    
##  DT            0.2     2016-08-09 CRAN (R 3.4.0)                    
##  evaluate      0.10.1  2017-06-24 CRAN (R 3.4.1)                    
##  glue          1.1.1   2017-06-21 CRAN (R 3.4.1)                    
##  graphics    * 3.4.2   2017-10-04 local                             
##  grDevices   * 3.4.2   2017-10-04 local                             
##  htmltools     0.3.6   2017-04-28 CRAN (R 3.4.0)                    
##  htmlwidgets   0.9     2017-07-10 CRAN (R 3.4.1)                    
##  httpuv        1.3.5   2017-07-04 CRAN (R 3.4.1)                    
##  jsonlite      1.5     2017-06-01 cran (@1.5)                       
##  knitr         1.17    2017-08-10 cran (@1.17)                      
##  magrittr      1.5     2014-11-22 CRAN (R 3.4.0)                    
##  memoise       1.1.0   2017-04-21 CRAN (R 3.4.0)                    
##  methods     * 3.4.2   2017-10-04 local                             
##  mime          0.5     2016-07-07 CRAN (R 3.4.0)                    
##  pkgconfig     2.0.1   2017-03-21 CRAN (R 3.4.0)                    
##  R6            2.2.2   2017-06-17 CRAN (R 3.4.0)                    
##  Rcpp          0.12.13 2017-09-28 cran (@0.12.13)                   
##  rlang         0.1.2   2017-08-09 CRAN (R 3.4.1)                    
##  rmarkdown     1.8     2017-11-17 CRAN (R 3.4.2)                    
##  rprojroot     1.2     2017-01-16 CRAN (R 3.4.0)                    
##  rsconnect     0.8.5   2017-09-07 Github (rstudio/rsconnect@abd491c)
##  rstudioapi    0.7     2017-09-07 cran (@0.7)                       
##  servr         0.8     2017-11-06 cran (@0.8)                       
##  stats       * 3.4.2   2017-10-04 local                             
##  stringi       1.1.6   2017-11-17 cran (@1.1.6)                     
##  stringr       1.2.0   2017-02-18 CRAN (R 3.4.0)                    
##  tibble        1.3.4   2017-08-22 CRAN (R 3.4.1)                    
##  tools       * 3.4.2   2017-10-04 local                             
##  utils       * 3.4.2   2017-10-04 local                             
##  withr         1.0.2   2016-06-20 CRAN (R 3.4.0)                    
##  xaringan      0.4     2017-08-09 CRAN (R 3.4.1)                    
##  yaml          2.1.14  2016-11-12 CRAN (R 3.4.0)
```
   
   
---
# Session
 + *Advanced!*  
 Package [containerit](https://github.com/o2r-project/containerit)  
 Automatically archiving reproducible studies with docker.  
   [&lt;img src="libs/www/docker_it.png"/ width="40%";&gt;](http://o2r.info/2017/05/30/containerit-package/)
  
---
# Markdown R

.pull-left[
+ Use [Rmarkdown](http://rmarkdown.rstudio.com), [jupiter notebooks](http://jupyter.org) or any other form of [literate programming](https://en.wikipedia.org/wiki/Literate_programming)

   &lt;img src="libs/www/rmarkdown-200x232.png"/ width="40%";&gt; 
&lt;img src="libs/www/jupiter_notebooks.png"/ width="50%";&gt;


]

.pull-right[
+ Use relative paths in favor of absolute paths  &lt;br \&gt;&lt;br \&gt;
   **Relative**
   
   ```r
   file.path("./LICENSE")
   ```
   
   ```
   ## [1] "./LICENSE"
   ```
   **Absolute**
   
   ```r
   library(tools)
   file_path_as_absolute("./LICENSE")
   ```
   
   ```
   ## [1] "/Users/RDynamics/Documents/R_folder/budapest_bi/LICENSE"
   ```

]


  
---
# Package versioning  

.pull-left[
+ Package `Packrat` by RStudio  

   [&lt;img src="libs/www/packrat.png"/ width="50%";&gt;](https://rstudio.github.io/packrat/rstudio.html) 
]

.pull-right[
+ Checkpoint by Microsoft


```r
library(checkpoint)
checkpoint("2017-09-01")
```

]



---
# Out of scope but important   

1. Unit testing (code and data) 
2. Code coverage 
3. Continuous Integration / Continuous Deployment  
4. ...

---
class: inverse, middle, center

# Collaboration
---
# Version control platforms

+ Choose the best platform for the team. 
+ Add a rich `README.md` with an overview of the analysis 
+ 3rd party data upload. Check legal  considerations! 

.pull-left[
[&lt;img src="libs/www/git.png"/ width="1000%";&gt;](https://about.gitlab.com)

]

.pull-right[
[&lt;img src="libs/www/readme.png"/ width="100%";&gt;](https://github.com/hadley/pkgdown)
]


---
# Structure
.pull-left[

+ Folder structure   
&lt;img src="libs/www/folder_strucutre.jpg"/ width="75%";&gt;  
*from* [Good enough practices in scientific computing](http://journals.plos.org/ploscompbiol/article/file?id=10.1371/ journal.pcbi.1005510&amp;type=printable)
]

.pull-right[
+ Naming conventions  
&lt;br \&gt;
[&lt;img src="libs/www/naming_conventions.png"/ width="100%";&gt;](https://www.youtube.com/watch?v=Pv5dfsHBBKE)
*Rasmus Bååth 5 minutes video at User2017!*

]
---
# Licensing 
[&lt;img src="libs/www/license.png"/ width="75%";&gt;](https://choosealicense.com)

---
# Cloud computing
   Out of scope...but important!

+ Calculations were done in Azure Data Science Virtual Machine on a `CentOS` linux distribution.  
+ Since I didn't use docker...the GIS packages have funny Unix library dependencies.


```bash
sudo yum update
sudo yum install gdal 
sudo yum install proj-devel
sudo yum install proj-nad
sudo yum install proj-epsg
sudo yum install geos-devel
```

+ MRAN is set up to 2017-09-01

```r
library(checkpoint)
checkpoint("2017-09-01")
```
---
# Reproducible Presentations

Different resources:
+ [Xaringan](https://slides.yihui.name/xaringan/) (RMarkdown presentation)  &lt;- This presentation! 
+ [Rpres](http://rmarkdown.rstudio.com/ioslides_presentation_format.html) from RStudio 
+ [Slidify](http://slidify.org) 

---
class: inverse, middle, center

# Summary
Data, Code, Environment &amp; Documentation

---

# Q&amp;A 

.pull-left[
&lt;img src="libs/www/logo_Rdynamics.png"/ width="100%";&gt; 
]

.pull-right[
&lt;img src="libs/www/user2017.jpeg"/ width="90%";image-align:center&gt; 

Carles CG  
Data Scientist &amp; freelanceR   

carles@reliabledynamics.com  
@carles_ 
]


---
class: inverse, middle, center

# Extra
---
# More resources
- [A Simple Explanation for the Replication Crisis in Science](https://simplystatistics.org/2015/12/11/instead-of-research- on-reproducibility-just-do-reproducible-research/)
- [Good enough practices in scientific computing](http://journals.plos.org/ploscompbiol/article/file?id=10.1371/ journal.pcbi.1005510&amp;type=printable)
- [Package `rrtools`](https://github.com/benmarwick/rrtools/blob/master/README.md).
- [Reproducibility guide](https://github.com/ropensci/ reproducibility-guide)

**Aknowledgements**

+ Thanks to David Gohel ([@DavidGohel](https://twitter.com/davidgohel?lang=en)) for sharing his presentation on GitHub. It made my intro to Xaringan much much easy!
    </textarea>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {window.dispatchEvent(new Event('resize'));});
(function() {var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler"); if (!r) return; s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }"; d.head.appendChild(s);})();</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre']
  }
});
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
